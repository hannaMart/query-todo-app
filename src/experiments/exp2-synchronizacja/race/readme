Exp2 — Race condition (React Query)
Цель эксперимента

Цель эксперимента — исследовать поведение синхронизации server-state при возникновении race condition в приложении React с использованием библиотеки React Query.

Эксперимент является прямым аналогом версии manual и проводится в тех же контролируемых условиях.

Описание сценария

Пользователь быстро изменяет параметр filter (all / active / completed).

Каждое изменение инициирует асинхронный запрос с случайной задержкой.

Ответы могут приходить в порядке, отличном от порядка отправки запросов.

Реализация (React Query)

Для управления server-state используется хук useQuery.

Ключ запроса имеет вид ["todos", filter].

При изменении filter React Query:

автоматически связывает ответ с соответствующим ключом запроса,

предотвращает перезапись данных устаревшими ответами.

В отличие от ручной реализации, не требуется дополнительная логика контроля актуальности ответа (счётчики, useRef и т.п.).

Наблюдения

Отображаемые данные всегда соответствуют текущему значению filter.

Эффект race condition не проявляется.

Интерфейс ведёт себя предсказуемо даже при быстрых последовательных действиях пользователя.

Промежуточный вывод

Использование React Query позволяет устранить проблему race condition на уровне механизма синхронизации server-state без ручного управления асинхронностью, что упрощает код и повышает его надёжность и читаемость.